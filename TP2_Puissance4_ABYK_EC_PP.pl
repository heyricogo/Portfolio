
% /brief EtatsGagnants : liste des états gagnants.
etats_gagnants:-
    [[[p, _, _, _, _, _], [p, _, _, _, _, _], [p, _, _, _, _, _], [p, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [p, _, _, _, _, _], [p, _, _, _, _, _], [p, _, _, _, _, _], [p, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [p, _, _, _, _, _], [p, _, _, _, _, _], [p, _, _, _, _, _], [p, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [p, _, _, _, _, _], [p, _, _, _, _, _], [p, _, _, _, _, _], [p, _, _, _, _, _]],



    [[_, p, _, _, _, _], [_, p, _, _, _, _], [_, p, _, _, _, _], [_, p, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, p, _, _, _, _], [_, p, _, _, _, _], [_, p, _, _, _, _], [_, p, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, p, _, _, _, _], [_, p, _, _, _, _], [_, p, _, _, _, _], [_, p, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, p, _, _, _, _], [_, p, _, _, _, _], [_, p, _, _, _, _], [_, p, _, _, _, _]],



    [[_, _, p, _, _, _], [_, _, p, _, _, _], [_, _, p, _, _, _], [_, _, p, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, p, _, _, _], [_, _, p, _, _, _], [_, _, p, _, _, _], [_, _, p, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, p, _, _, _], [_, _, p, _, _, _], [_, _, p, _, _, _], [_, _, p, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, p, _, _, _], [_, _, p, _, _, _], [_, _, p, _, _, _], [_, _, p, _, _, _]],



    [[_, _, _, p, _, _], [_, _, _, p, _, _], [_, _, _, p, _, _], [_, _, _, p, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, p, _, _], [_, _, _, p, _, _], [_, _, _, p, _, _], [_, _, _, p, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, p, _, _], [_, _, _, p, _, _], [_, _, _, p, _, _], [_, _, _, p, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, p, _, _], [_, _, _, p, _, _], [_, _, _, p, _, _], [_, _, _, p, _, _]],



    [[_, _, _, _, p, _], [_, _, _, _, p, _], [_, _, _, _, p, _], [_, _, _, _, p, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, p, _], [_, _, _, _, p, _], [_, _, _, _, p, _], [_, _, _, _, p, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, p, _], [_, _, _, _, p, _], [_, _, _, _, p, _], [_, _, _, _, p, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, p, _], [_, _, _, _, p, _], [_, _, _, _, p, _], [_, _, _, _, p, _]],



    [[_, _, _, _, _, p], [_, _, _, _, _, p], [_, _, _, _, _, p], [_, _, _, _, _, p], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, p], [_, _, _, _, _, p], [_, _, _, _, _, p], [_, _, _, _, _, p], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, p], [_, _, _, _, _, p], [_, _, _, _, _, p], [_, _, _, _, _, p], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, p], [_, _, _, _, _, p], [_, _, _, _, _, p], [_, _, _, _, _, p]],







    [[p, p, p, p, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, p, p, p, p, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, p, p, p, p], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],



    [[_, _, _, _, _, _], [p, p, p, p, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, p, p, p, p, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, p, p, p, p], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],



    [[_, _, _, _, _, _], [_, _, _, _, _, _], [p, p, p, p, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, p, p, p, p, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, p, p, p, p], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],



    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [p, p, p, p, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, p, p_, p, p, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, p, p, p, p], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],



    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [p, p, p, p, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, p, p, p, p, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, p, p, p, p], [_, _, _, _, _, _], [_, _, _, _, _, _]],



    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [p, p, p, p, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, p, p, p, p, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, p, p, p, p], [_, _, _, _, _, _]],



    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [p, p, p, p, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, p, p, p, p, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, p, p, p, p]],







    [[p, _, _, _, _, _], [_, p, _, _, _, _], [_, _, p, _, _, _], [_, _, _, p, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [p, _, _, _, _, _], [_, p, _, _, _, _], [_, _, p, _, _, _], [_, _, _, p, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [p, _, _, _, _, _], [_, p, _, _, _, _], [_, _, p, _, _, _], [_, _, _, p, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [p, _, _, _, _, _], [_, p, _, _, _, _], [_, _, p, _, _, _], [_, _, _, p, _, _]],



    [[_, p, _, _, _, _], [_, _, p, _, _, _], [_, _, _, p, _, _], [_, _, _, _, p, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, p, _, _, _, _], [_, _, p, _, _, _], [_, _, _, p, _, _], [_, _, _, _, p, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, p, _, _, _, _], [_, _, p, _, _, _], [_, _, _, p, _, _], [_, _, _, _, p, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, p, _, _, _, _], [_, _, p, _, _, _], [_, _, _, p, _, _], [_, _, _, _, p, _]],



    [[_, _, p, _, _, _], [_, _, _, p, _, _], [_, _, _, _, p, _], [_, _, _, _, _, p], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, p, _, _, _], [_, _, _, p, _, _], [_, _, _, _, p, _], [_, _, _, _, _, p], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, p, _, _, _], [_, _, _, p, _, _], [_, _, _, _, p, _], [_, _, _, _, _, p], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, p, _, _, _], [_, _, _, p, _, _], [_, _, _, _, p, _], [_, _, _, _, _, p]],



    [[_, _, _, p, _, _], [_, _, p, _, _, _], [_, p, _, _, _, _], [p, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, p, _, _], [_, _, p, _, _, _], [_, p, _, _, _, _], [p, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, p, _, _], [_, _, p, _, _, _], [_, p, _, _, _, _], [p, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, p, _, _], [_, _, p, _, _, _], [_, p, _, _, _, _], [p, _, _, _, _, _]],



    [[_, _, _, _, p, _], [_, _, _, p, _, _], [_, _, p, _, _, _], [_, p, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, p, _], [_, _, _, p, _, _], [_, _, p, _, _, _], [_, p, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, p, _], [_, _, _, p, _, _], [_, _, p, _, _, _], [_, p, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, p, _], [_, _, _, p, _, _], [_, _, p, _, _, _], [_, p, _, _, _, _]],



    [[_, _, _, _, _, p], [_, _, _, _, p, _], [_, _, _, p, _, _], [_, _, p, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, p], [_, _, _, _, p, _], [_, _, _, p, _, _], [_, _, p, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, p], [_, _, _, _, p, _], [_, _, _, p, _, _], [_, _, p, _, _, _], [_, _, _, _, _, _]],

    [[_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, _], [_, _, _, _, _, p], [_, _, _, _, p, _], [_, _, _, p, _, _], [_, _, p, _, _, _]]


    ].


% Ã©tan initial, la grille est vide au dÃ©but du jeu

jouer :- tourJoueurJaune([[],[],[],[],[],[],[]]).

% rgle de jeu pour tourJoueurJaune

tourJoueurJaune(GrilleDeJeu) :- conditionFinJeu(GrilleDeJeu, JoueurCourrant), affichageGrille(GrilleDeJeu), write(JoueurCourrant), nl, !.
tourJoueurJaune(GrilleDeJeu) :- affichageGrille(GrilleDeJeu), nl, read(Colonne), coupJoueurCourant(GrilleDeJeu, Colonne, j, GrilleApresCoup), tourJoueurRouge(GrilleApresCoup).
tourJoueurRouge(GrilleDeJeu) :- conditionFinJeu(GrilleDeJeu, JoueurCourrant), affichageGrille(GrilleDeJeu), write(JoueurCourrant), nl, !.
tourJoueurRouge(GrilleDeJeu) :- affichageGrille(GrilleDeJeu), nl, selectionnerCoupIA(GrilleDeJeu, Colonne), coupJoueurCourant(GrilleDeJeu, Colonne, r, GrilleApresCoup), tourJoueurJaune(GrilleApresCoup).

% nombre de possibilitÃ© de pions Ã  mettre dans la grille de jeu

nombreDePion(N, Liste, []):- longueurListe(Liste, N1), N1 < N.
nombreDePion(N, Liste, P) :- longueurListe(Liste, N1), N2 is N1-N+1, nth1(N2, Liste, P).

% operation pour un joueur

coupJoueurCourant([Liste1, Liste2, Liste3, Liste4, Liste5, Liste6, Liste7], 1, P, [[P|Liste1], Liste2, Liste3, Liste4, Liste5, Liste6, Liste7]) :- longueurListe(Liste1, N), N < 6 .
coupJoueurCourant([Liste1, Liste2, Liste3, Liste4, Liste5, Liste6, Liste7], 2, P, [Liste1, [P|Liste2], Liste3, Liste4, Liste5, Liste6, Liste7]) :- longueurListe(Liste2, N), N < 6 .
coupJoueurCourant([Liste1, Liste2, Liste3, Liste4, Liste5, Liste6, Liste7], 3, P, [Liste1, Liste2, [P|Liste3], Liste4, Liste5, Liste6, Liste7]) :- longueurListe(Liste3, N), N < 6 .
coupJoueurCourant([Liste1, Liste2, Liste3, Liste4, Liste5, Liste6, Liste7], 4, P, [Liste1, Liste2, Liste3, [P|Liste4], Liste5, Liste6, Liste7]) :- longueurListe(Liste4, N), N < 6 .
coupJoueurCourant([Liste1, Liste2, Liste3, Liste4, Liste5, Liste6, Liste7], 5, P, [Liste1, Liste2, Liste3, Liste4, [P|Liste5], Liste6, Liste7]) :- longueurListe(Liste5, N), N < 6 .
coupJoueurCourant([Liste1, Liste2, Liste3, Liste4, Liste5, Liste6, Liste7], 6, P, [Liste1, Liste2, Liste3, Liste4, Liste5, [P|Liste6], Liste7]) :- longueurListe(Liste6, N), N < 6 .
coupJoueurCourant([Liste1, Liste2, Liste3, Liste4, Liste5, Liste6, Liste7], 7, P, [Liste1, Liste2, Liste3, Liste4, Liste5, Liste6, [P|Liste7]]) :- longueurListe(Liste7, N), N < 6 .


%chaque colonne de jeu est une liste, N est la longueur de chaque liste
% Nous avons 7 colonnes

longueurListe([], 0).
longueurListe([P|Liste], N) :- longueurListe(Liste, N1), N=N1+1.


% affichage de la grille de jeu

affichageGrille(GrilleDeJeu) :- affichage(GrilleDeJeu, 6).
affichage(_, 0).
affichage(GrilleDeJeu, N) :- maplist(nombreDePion(N), GrilleDeJeu, Liste), write(')( '), afficherListe(Liste), N1 is N-1, affichage(GrilleDeJeu, N1).
afficherListe([]) :- nl.
afficherListe([P|Liste]) :- afficherPion(P), afficherListe(Liste).
afficherPion([]) :- write('  )( '), !.
afficherPion(P) :- write(P), write(' )( ').


conditionFinJeu(GrilleDeJeu, JoueurCourrant) :- testAlignementHorizontal(GrilleDeJeu, JoueurCourrant).
conditionFinJeu(GrilleDeJeu, JoueurCourrant) :- testAlignementVertical(GrilleDeJeu, JoueurCourrant).
conditionFinJeu(GrilleDeJeu, JoueurCourrant) :- testGrillePleine(GrilleDeJeu).

%------------------------------------------------------------------------------------------------------------------------------------------------------------------------
testAlignementHorizontal([_, _, _, Liste4, Liste5, Liste6, Liste7], JoueurCourrant) :- testAlignementQuatrePionHorizotalement([Liste4, Liste5, Liste6, Liste7], JoueurCourrant, 6).
testAlignementHorizontal([_, _, _, Liste4, Liste5, Liste6, Liste7], JoueurCourrant) :- testAlignementQuatrePionHorizotalement([Liste4, Liste5, Liste6, Liste7], JoueurCourrant, 5).
testAlignementHorizontal([_, _, _, Liste4, Liste5, Liste6, Liste7], JoueurCourrant) :- testAlignementQuatrePionHorizotalement([Liste4, Liste5, Liste6, Liste7], JoueurCourrant, 4).
testAlignementHorizontal([_, _, _, Liste4, Liste5, Liste6, Liste7], JoueurCourrant) :- testAlignementQuatrePionHorizotalement([Liste4, Liste5, Liste6, Liste7], JoueurCourrant, 3).
testAlignementHorizontal([_, _, _, Liste4, Liste5, Liste6, Liste7], JoueurCourrant) :- testAlignementQuatrePionHorizotalement([Liste4, Liste5, Liste6, Liste7], JoueurCourrant, 2).
testAlignementHorizontal([_, _, _, Liste4, Liste5, Liste6, Liste7], JoueurCourrant) :- testAlignementQuatrePionHorizotalement([Liste4, Liste5, Liste6, Liste7], JoueurCourrant, 1).

testAlignementHorizontal([_, _, Liste3, Liste4, Liste5, Liste6, _], JoueurCourrant) :- testAlignementQuatrePionHorizotalement([Liste3, Liste4, Liste5, Liste6], JoueurCourrant, 6).
testAlignementHorizontal([_, _, Liste3, Liste4, Liste5, Liste6, _], JoueurCourrant) :- testAlignementQuatrePionHorizotalement([Liste3, Liste4, Liste5, Liste6], JoueurCourrant, 5).
testAlignementHorizontal([_, _, Liste3, Liste4, Liste5, Liste6, _], JoueurCourrant) :- testAlignementQuatrePionHorizotalement([Liste3, Liste4, Liste5, Liste6], JoueurCourrant, 4).
testAlignementHorizontal([_, _, Liste3, Liste4, Liste5, Liste6, _], JoueurCourrant) :- testAlignementQuatrePionHorizotalement([Liste3, Liste4, Liste5, Liste6], JoueurCourrant, 3).
testAlignementHorizontal([_, _, Liste3, Liste4, Liste5, Liste6, _], JoueurCourrant) :- testAlignementQuatrePionHorizotalement([Liste3, Liste4, Liste5, Liste6], JoueurCourrant, 2).
testAlignementHorizontal([_, _, Liste3, Liste4, Liste5, Liste6, _], JoueurCourrant) :- testAlignementQuatrePionHorizotalement([Liste3, Liste4, Liste5, Liste6], JoueurCourrant, 1).

testAlignementHorizontal([_, Liste2, Liste3, Liste4, Liste5, _, _], JoueurCourrant) :- testAlignementQuatrePionHorizotalement([Liste2, Liste3, Liste4, Liste5], JoueurCourrant, 6).
testAlignementHorizontal([_, Liste2, Liste3, Liste4, Liste5, _, _], JoueurCourrant) :- testAlignementQuatrePionHorizotalement([Liste2, Liste3, Liste4, Liste5], JoueurCourrant, 5).
testAlignementHorizontal([_, Liste2, Liste3, Liste4, Liste5, _, _], JoueurCourrant) :- testAlignementQuatrePionHorizotalement([Liste2, Liste3, Liste4, Liste5], JoueurCourrant, 4).
testAlignementHorizontal([_, Liste2, Liste3, Liste4, Liste5, _, _], JoueurCourrant) :- testAlignementQuatrePionHorizotalement([Liste2, Liste3, Liste4, Liste5], JoueurCourrant, 3).
testAlignementHorizontal([_, Liste2, Liste3, Liste4, Liste5, _, _], JoueurCourrant) :- testAlignementQuatrePionHorizotalement([Liste2, Liste3, Liste4, Liste5], JoueurCourrant, 2).
testAlignementHorizontal([_, Liste2, Liste3, Liste4, Liste5, _, _], JoueurCourrant) :- testAlignementQuatrePionHorizotalement([Liste2, Liste3, Liste4, Liste5], JoueurCourrant, 1).

testAlignementHorizontal([Liste1, Liste2, Liste3, Liste4, _, _, _], JoueurCourrant) :- testAlignementQuatrePionHorizotalement([Liste1, Liste2, Liste3, Liste4], JoueurCourrant, 6).
testAlignementHorizontal([Liste1, Liste2, Liste3, Liste4, _, _, _], JoueurCourrant) :- testAlignementQuatrePionHorizotalement([Liste1, Liste2, Liste3, Liste4], JoueurCourrant, 5).
testAlignementHorizontal([Liste1, Liste2, Liste3, Liste4, _, _, _], JoueurCourrant) :- testAlignementQuatrePionHorizotalement([Liste1, Liste2, Liste3, Liste4], JoueurCourrant, 4).
testAlignementHorizontal([Liste1, Liste2, Liste3, Liste4, _, _, _], JoueurCourrant) :- testAlignementQuatrePionHorizotalement([Liste1, Liste2, Liste3, Liste4], JoueurCourrant, 3).
testAlignementHorizontal([Liste1, Liste2, Liste3, Liste4, _, _, _], JoueurCourrant) :- testAlignementQuatrePionHorizotalement([Liste1, Liste2, Liste3, Liste4], JoueurCourrant, 2).
testAlignementHorizontal([Liste1, Liste2, Liste3, Liste4, _, _, _], JoueurCourrant) :- testAlignementQuatrePionHorizotalement([Liste1, Liste2, Liste3, Liste4], JoueurCourrant, 1).

testAlignementQuatrePionHorizotalement(LigneHorizontale, J, N) :- maplist(nombreDePion(N), LigneHorizontale, Liste), quatrePionAligner(Liste, J).
quatrePionAligner([J, J, J, J], J) :- not(J==[]).

%--------------------------------------------------------------------------------------------------------------------
testAlignementVertical([Liste1, _, _, _, _, _, _], JoueurCourrant) :- testAlignementQuatrePionVerticalement(Liste1, JoueurCourrant).
testAlignementVertical([_, Liste2, _, _, _, _, _], JoueurCourrant) :- testAlignementQuatrePionVerticalement(Liste2, JoueurCourrant).
testAlignementVertical([_, _, Liste3, _, _, _, _], JoueurCourrant) :- testAlignementQuatrePionVerticalement(Liste3, JoueurCourrant).
testAlignementVertical([_, _, _, Liste4, _, _, _], JoueurCourrant) :- testAlignementQuatrePionVerticalement(Liste4, JoueurCourrant).
testAlignementVertical([_, _, _, _, Liste5, _, _], JoueurCourrant) :- testAlignementQuatrePionVerticalement(Liste5, JoueurCourrant).
testAlignementVertical([_, _, _, _, _, Liste6, _], JoueurCourrant) :- testAlignementQuatrePionVerticalement(Liste6, JoueurCourrant).
testAlignementVertical([_, _, _, _, _, _, Liste7], JoueurCourrant) :- testAlignementQuatrePionVerticalement(Liste7, JoueurCourrant).

testAlignementQuatrePionVerticalement([JoueurCourrant, JoueurCourrant, JoueurCourrant, JoueurCourrant|Liste], JoueurCourrant).
testAlignementQuatrePionVerticalement([P|Liste], J) :- testAlignementQuatrePionVerticalement(Liste, J).

%------------------------------------------------------------------------------------------------------------------
testGrillePleine([]):- NombreDeColonnesPleines=7.
testGrillePleine([Colonne|ListeColonnes]):- length(Colonne, N), N=6, testGrillePleine(ListeColonnes).



%------------------------------------------------------------------------------------------------------------------

selectionnerCoupIA(GrilleDeJeu, Colonne) :- remplirColonneIA(GrilleDeJeu, Colonne), !.
selectionnerCoupIA(GrilleDeJeu, Colonne) :- remplirLigneIA(GrilleDeJeu, Colonne), !.
selectionnerCoupIA(GrilleDeJeu, Colonne) :- blockerCoupAdversaireIA(GrilleDeJeu, Colonne), !.
selectionnerCoupIA(GrilleDeJeu, Colonne) :-
    listeLegaux_1(GrilleDeJeu, Liste),
    elementListeHazard(Liste, N),
    Colonne is N.



listeLegaux_1([Colonne|ListeColonnes], [1|ListeColonnesLegales]):- longueurListe(Colonne, N), N<6, listeLegaux_2(ListeColonnes, ListeColonnesLegales).
listeLegaux_1([Colonne|ListeColonnes], ListeColonnesLegales):-  listeLegaux_2(ListeColonnes, ListeColonnesLegales), longueurListe(Colonne, N), not(N<6).
listeLegaux_2([Colonne|ListeColonnes], [2|ListeColonnesLegales]):- longueurListe(Colonne, N), N<6, listeLegaux_3(ListeColonnes, ListeColonnesLegales).
listeLegaux_2([Colonne|ListeColonnes], ListeColonnesLegales):-  listeLegaux_3(ListeColonnes, ListeColonnesLegales), longueurListe(Colonne, N), not(N<6).
listeLegaux_3([Colonne|ListeColonnes], [3|ListeColonnesLegales]):- longueurListe(Colonne, N), N<6, listeLegaux_4(ListeColonnes, ListeColonnesLegales).
listeLegaux_3([Colonne|ListeColonnes], ListeColonnesLegales):-  listeLegaux_4(ListeColonnes, ListeColonnesLegales), longueurListe(Colonne, N), not(N<6).
listeLegaux_4([Colonne|ListeColonnes], [4|ListeColonnesLegales]):- longueurListe(Colonne, N), N<6, listeLegaux_5(ListeColonnes, ListeColonnesLegales).
listeLegaux_4([Colonne|ListeColonnes], ListeColonnesLegales):-  listeLegaux_5(ListeColonnes, ListeColonnesLegales), longueurListe(Colonne, N), not(N<6).
listeLegaux_5([Colonne|ListeColonnes], [5|ListeColonnesLegales]):- longueurListe(Colonne, N), N<6, listeLegaux_6(ListeColonnes, ListeColonnesLegales).
listeLegaux_5([Colonne|ListeColonnes], ListeColonnesLegales):-  listeLegaux_6(ListeColonnes, ListeColonnesLegales), longueurListe(Colonne, N), not(N<6).
listeLegaux_6([Colonne|ListeColonnes], [6|ListeColonnesLegales]):- longueurListe(Colonne, N), N<6, listeLegaux_7(ListeColonnes, ListeColonnesLegales).
listeLegaux_6([Colonne|ListeColonnes], ListeColonnesLegales):-  listeLegaux_7(ListeColonnes, ListeColonnesLegales), longueurListe(Colonne, N), not(N<6).
listeLegaux_7([Colonne|ListeColonnes], [7|ListeColonnesLegales]):- longueurListe(Colonne, N), N<6.
listeLegaux_7([Colonne|ListeColonnes], ListeColonnesLegales):- longueurListe(Colonne, N), not(N<6).



elementListeHazard([], []):- !.
elementListeHazard(Liste, N) :-
        length(Liste, Longueur),
        random(0, Longueur, Index),
        nth0(Index, Liste, N).


remplirColonneIA(GrilleDeJeu, Colonne) :- coupJoueurCourant(GrilleDeJeu, Colonne, r, GrilleApresCoup), testAlignementVertical(GrilleApresCoup, r).
remplirLigneIA(GrilleDeJeu, Colonne) :- coupJoueurCourant(GrilleDeJeu, Colonne, r, GrilleApresCoup), testAlignementHorizontal(GrilleApresCoup, r).
blockerCoupAdversaireIA(GrilleDeJeu, Colonne) :- coupJoueurCourant(GrilleDeJeu, Colonne, j, GrilleApresCoup), conditionFinJeu(GrilleApresCoup,j).



% /brief trouver_etats_legaux : permet de générer une liste de tous les
% états légaux atteignables à partir de l'état courant.
trouver_etats_legaux(EtatCourant, ListeEtatsLegaux):-
    coupJoueurCourant(EtatCourant, 1, JoueurCourant, EtatSuivant),
    coupJoueurCourant(EtatCourant, 2, JoueurCourant, EtatSuivant),
    coupJoueurCourant(EtatCourant, 3, JoueurCourant, EtatSuivant),
    coupJoueurCourant(EtatCourant, 4, JoueurCourant, EtatSuivant),
    coupJoueurCourant(EtatCourant, 5, JoueurCourant, EtatSuivant),
    coupJoueurCourant(EtatCourant, 6, JoueurCourant, EtatSuivant),
    coupJoueurCourant(EtatCourant, 7, JoueurCourant, EtatSuivant),
    findall(EtatSuivant, coupJoueurCourant(_,_,_,EtatSuivant), ListeEtatsLegaux).



% /brief trouver_numeros_legaux : permet de générer une liste des
% numéros de tous les coups légaux possibles à partir de l'état courant.
trouver_numeros_legaux(EtatCourant, ListeNumerosLegaux):-
    coupJoueurCourant(EtatCourant, 1, JoueurCourant, EtatSuivant),
    coupJoueurCourant(EtatCourant, 2, JoueurCourant, EtatSuivant),
    coupJoueurCourant(EtatCourant, 3, JoueurCourant, EtatSuivant),
    coupJoueurCourant(EtatCourant, 4, JoueurCourant, EtatSuivant),
    coupJoueurCourant(EtatCourant, 5, JoueurCourant, EtatSuivant),
    coupJoueurCourant(EtatCourant, 6, JoueurCourant, EtatSuivant),
    coupJoueurCourant(EtatCourant, 7, JoueurCourant, EtatSuivant),
    findall(Numero, coupJoueurCourant(_,Numero,_,_), ListeNumerosLegaux).



% /brief valeur_heuristique_ordi : permet de trouver la valeur
% heuristique des états, ce qui permet à l'ordi de prendre des décisions
% sur les coups qu'il jouera.
% /param EtatCourant : est un ensemble de listes décrivant l'état dont
% on cherche la valeur heuristique.
% /param EtatsGagnants : est une liste comprenant les différents états
% gagnants possibles.
% /param NumeroCoup : est un entier représentant le numéro du coup dont
% on veut trouver la valeur heuristique. Inutile pour cette
% fonction, mais utile pour la fonction decision_ordi, qui utilise
% valeur_heuristique_ordi.
% /param ListeEtatsLegaux : est la liste des états légaux
% atteignables à partir de l'état courant.
% /param ListeNumerosLegaux : est la liste des numéros des coups légaux,
% dans le même ordre que les états légaux correspondants sont dans ListeEtatsLegaux.
% /value JoueurCourant : le joueur qui joue ce
% coup, décrit par la couleur de ses jetons.
% /value ValMax : est la
% valeur entière maximale parmis les Val comparés.
% /value ListeVal : est
% la liste des valeurs heuristiques à comparer.
% /value Val : est une
% valeur entière représentant la valeur heuristique d'un état.
% /return Valeur : est une valeur entière représentant la valeur
% heuristique de l'état courant.

% Si l'état est le premier de la liste des états gagnants, on retourne
% sa valeur + 0.
valeur_heuristique_ordi(EtatCourant, [EtatCourant | EtatsGagnants],
                        Valeur, Compteur, NumeroCoup, ListeEtatsLegaux, ListeNumerosLegaux):-
    Valeur is 0, !.

% Si l'état n'est pas le premier de la liste des états gagnants, on fait
% un appel récursif pour voir si c'est le prochain état de cette liste.
valeur_heuristique_ordi(EtatCourant, [E | EtatsGagnants], Valeur, Compteur, NumeroCoup, ListeEtatsLegaux, ListeNumerosLegaux):-
    valeur_heuristique_ordi(EtatCourant, EtatsGagnants, Valeur, Compteur, NumeroCoup, ListeEtatsLegaux, ListeNumerosLegaux), !.

% Si l'état n'est pas gagnant, on trouve la valeur de tous les
% états suivants possibles.
valeur_heuristique_ordi(EtatCourant, [], Valeur, Compteur, NumeroCoup, [E|ListeEtatsLegaux], [N|ListeNumerosLegaux]):-
    valeur_heuristique_joueur(coupJoueurCourant(EtatCourant, N, JoueurCourant, EtatSuivant), LesEtatsGagnant, Valeur_1, Compteur_1, NumeroCoup,
                              [E|ListeEtatsLegaux], [N|ListeNumerosLegaux]),
    valeur_heuristique_ordi(EtatCourant, [], Valeur, Compteur, NumeroCoup, ListeEtatsLegaux, ListeNumerosLegaux).

% Après avoir trouvé la valeur de tous les états suivants, on donne à
% l'état courant la valeur la plus haute parmi celles des états suivants
% possibles, car c'est le coup le plus probable du joueur humain jouant
% optimalement (min).
valeur_heuristique_ordi(EtatCourant, [], Valeur, Compteur, NumeroCoup, [], []):-
    findall(Val, valeur_heuristique_joueur(_, _, Val, _, _, _, _), ListeVal),
    plus_grand_element_liste(ValMax, ListeVal),
    Valeur is ValMax + 1,
    Compteur is Compteur_1 + 1, !.

% Si l'état n'est pas gagnant et que le compteur atteint la valeur de 0,
% on ne fait plus d'appel récursif et on retourne simplement la valeur
% de Valeur.
valeur_heuristique_ordi(EtatCourant, [], Valeur, 0, NumeroCoup, ListeEtatsLegaux, ListeNumerosLegaux):-
    Valeur is 1, !.


% /brief valeur_heuristique_joueur : aide valeur_heuristique_ordi à
% simuler les coups du joueur humain selon un comportement minpour
% donner une meilleure estimation de la valeur heuristique des états
% /param EtatCourant : est un ensemble de listes décrivant l'état dont
% on cherche la valeur heuristique.
% /param EtatsGagnants : est une liste comprenant les différents états
% gagnants possibles.
% /param NumeroCoup : est un entier représentant le numéro du coup dont
% on veut trouver la valeur heuristique. Inutile pour cette
% fonction, mais utile pour la fonction decision_ordi, qui utilise
% valeur_heuristique_ordi.
% /param ListeEtatsLegaux : est la liste des états légaux
% atteignables à partir de l'état courant.
% /param ListeNumerosLegaux : est la liste des numéros des coups légaux,
% dans le même ordre que les états légaux correspondants sont dans ListeEtatsLegaux.
% /value JoueurCourant : le joueur qui joue ce coup, décrit par la
% couleur de ses jetons.
% /value ValMin : est la valeur entière minimale parmis les Val
% comparés.
% /value ListeVal : est la liste des valeurs heuristiques à comparer.
% /value Val : est une valeur entière représentant la valeur heuristique
% d'un état.
% /return Valeur : est une valeur entière représentant la valeur
% heuristique de l'état courant.

% Si l'état est le premier de la liste des états gagnants, on retourne
% sa valeur + 10 pour donner une priorité élevée à l'opération menant à
% cet état, car cette opération sera probablement utilisée par le
% joueur.
valeur_heuristique_joueur(EtatCourant, [EtatCourant | EtatsGagnants],
                          Valeur, Compteur, NumeroCoup, ListeEtatsLegaux, ListeNumerosLegaux):-
    Valeur is 10, !.

% Si l'état n'est pas le premier de la liste des états gagnants, on fai
% un appel récursif pour voir si c'est le prochain état de cette liste.
valeur_heuristique_joueur(EtatCourant, [E | EtatsGagnants], Valeur, Compteur, NumeroCoup, ListeEtatsLegaux, ListeNumerosLegaux):-
    valeur_heuristique_joueur(EtatCourant, EtatsGagnants, Valeur, Compteur, NumeroCoup), !.

% Si l'état n'est pas gagnant, on trouve la valeur de tous les
% états suivants possibles.
valeur_heuristique_joueur(EtatCourant, [], Valeur, Compteur, NumeroCoup, ListeEtatsLegaux, ListeNumerosLegaux):-
    valeur_heuristique_ordi(coupJoueurCourant(EtatCourant, N, JoueurCourant, EtatSuivant), LesEtatsGagnant, Valeur_1, Compteur_1, NumeroCoup,
                              [E|ListeEtatsLegaux], [N|ListeNumerosLegaux]),
    valeur_heuristique_joueur(EtatCourant, [], Valeur, Compteur, NumeroCoup, ListeEtatsLegaux, ListeNumerosLegaux).

% Après avoir trouvé la valeur de tous les états suivant, on donne à
% l'état courant la valeur la plus haute parmi celles des états suivants
% possibles, car c'est le coup le plus probable de l'ordinateur jouant
% optimalement (max).
valeur_heuristique_joueur(EtatCourant, [], Valeur, Compteur, NumeroCoup, [], []):-
    findall(Val, valeur_heuristique_joueur(_, _, Val, _, _, _, _), ListeVal),
    plus_petit_element_liste(ValMin, ListeVal),
    Valeur is ValMin + 1,
    Compteur is Compteur_1 + 1, !.

% Si l'état n'est pas gagnant et que le compteur atteint la valeur de 0,
% on ne fait plus d'appel récursif et on retourne simplement la valeur
% de Valeur.
valeur_heuristique_joueur(EtatCourant, [], Valeur, 0, NumeroCoup, ListeEtatsLegaux, ListeNumerosLegaux):-
    Valeur is 1, !.



% /brief plus_petit_element_liste : permet de trouver le plus petit
% élément d'une liste.
% /param Liste : est la liste de valeurs entières dont on cherche la
% valeur minimale.
% /return ValeurMin : est la valeur entière minimale de la liste jusqu'à
% présent.
plus_petit_element_liste(1000, []):- !.

plus_petit_element_liste(ValeurMin, [L|Liste]):-
    plus_petit_element_liste(ValeurMin_1, Liste),
    ValeurMin is min(L, ValeurMin_1), !.



% /brief plus_grand_element_liste : permet de trouver le plus grand
% élément d'une liste.
% /param Liste : est la liste de valeurs entières dont on cherche la
% valeur maximale.
% /return ValeurMax : est la valeur entière maximale de la liste jusqu'à
% présent.
plus_grand_element_liste(0, []):- !.

plus_grand_element_liste(ValeurMax, [L|Liste]):-
    plus_grand_element_liste(ValeurMax_1, Liste),
    ValeurMax is max(L, ValeurMax_1), !.


% /brief decision_ordi : permet au joueur ordinateur de prendre des
% décision en ce qui à trait au coup qu'il devrait jouer. L'ordi prendra
% la décision de jouer le coup ayant la valeur heuristique la plus
% basse.
% /param EtatCourant : est l'état à partir duquel on veut prendre la
% décision.
% /param EtatsGagnants : est la liste des états gagnants.
% /param ListeEtatsLegaux : est la liste des états légaux
% atteignables à partir de l'état courant.
% /param ListeNumerosLegaux : est la liste des numéros des coups légaux,
% dans le même ordre que les états légaux correspondants sont dans
% ListeEtatsLegaux.
% /return : rien.

% S'il n'y a plus d'état légal non traité, on fait une liste de toutes
% les valeurs trouvées, on trouve la valeur la plus petite et on joue le
% coup correspondant à cette valeur heuristique.
decision_ordi(EtatCourant, EtatsGagnants, [], []):-
    findall(Val, valeur_heuristique_ordi(_, _, Val, _, _, _, _), ListeVal),
    plus_petit_element_liste(ValMin, ListeVal),
    findall(NumeroCoup, valeur_heuristique_ordi(_,_,ValMin, _, NumeroCoup, _, _), [C|MeilleurCoup]),
    coupJoueurCourant(EtatCourant, C, JoueurCourant, EtatSuivant),
    !.

% S'il reste des états légaux à traiter, on trouve la valeur heuristique
% du prochain état légal en s'assurant d'attribuer cette valeur au bon
% numero de coup, puis on fait un appel récursif à decision_ordi pour
% traiter le reste des états légaux.
decision_ordi(EtatCourant, EtatsGagnants, [E|ListeEtatsLegaux], [N|ListeNumerosLegaux]):-
    valeur_heuristique_ordi(E, EtatsGagnants, Valeur, 5, N, LesEtatsLegaux, LesNumerosLegaux),
    decision_ordi(EtatCourant, EtatsGagnants, ListeEtatsLegaux, ListeNumerosLegaux).
